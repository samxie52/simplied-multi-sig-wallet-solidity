<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiSig Wallet - Sepoliaæµ‹è¯•ç½‘äº¤äº’</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2196F3 0%, #21CBF3 100%);
            min-height: 100vh;
            color: #333;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }
        .header h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .subtitle {
            font-size: 1.2em;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
        }
        .warning-banner {
            background: rgba(255, 152, 0, 0.1);
            border: 2px solid #FF9800;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            color: white;
            text-align: center;
        }
        .network-info {
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            color: white;
        }
        .network-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .network-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
        }
        .status-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            color: white;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .status-item { text-align: center; }
        .status-value {
            font-size: 1.8em;
            font-weight: bold;
            display: block;
        }
        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        .demo-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .demo-section h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.8em;
            border-bottom: 3px solid #2196F3;
            padding-bottom: 10px;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .btn {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #FF9800, #FF5722);
        }
        .btn-danger {
            background: linear-gradient(135deg, #F44336, #E91E63);
        }
        .log-section {
            grid-column: 1 / -1;
            background: #1a1a1a;
            color: #00ff00;
            border-radius: 15px;
            padding: 30px;
            font-family: 'Courier New', monospace;
            max-height: 500px;
            overflow-y: auto;
        }
        .log-entry {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
        }
        .log-entry.info { background: rgba(0, 255, 0, 0.1); }
        .log-entry.warning { background: rgba(255, 165, 0, 0.1); color: #FFA500; }
        .log-entry.error { background: rgba(255, 0, 0, 0.1); color: #ff0000; }
        .log-entry.success { background: rgba(0, 255, 0, 0.1); color: #00ff00; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ MultiSig Wallet</h1>
            <div class="subtitle">Sepoliaæµ‹è¯•ç½‘å®æ—¶äº¤äº’æ¼”ç¤º</div>
        </div>

        <div class="warning-banner">
            <strong>âš ï¸ æµ‹è¯•ç½‘ç¯å¢ƒ</strong><br>
            æœ¬é¡µé¢è¿æ¥åˆ°Sepoliaæµ‹è¯•ç½‘ï¼Œä½¿ç”¨çš„æ˜¯æµ‹è¯•ETHï¼Œæ²¡æœ‰å®é™…ä»·å€¼ã€‚
        </div>

        <div class="network-info">
            <h3>ğŸ”— Sepoliaæµ‹è¯•ç½‘ä¿¡æ¯</h3>
            <div class="network-details">
                <div class="network-item">
                    <strong>ç½‘ç»œåç§°:</strong> Sepolia<br>
                    <strong>é“¾ID:</strong> 11155111
                </div>
                <div class="network-item">
                    <strong>åŒºå—æµè§ˆå™¨:</strong><br>
                    <a href="https://sepolia.etherscan.io/" target="_blank" style="color: #FFE082;">sepolia.etherscan.io</a>
                </div>
                <div class="network-item">
                    <strong>æµ‹è¯•ETHæ°´é¾™å¤´:</strong><br>
                    <a href="https://sepoliafaucet.com/" target="_blank" style="color: #FFE082;">sepoliafaucet.com</a>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-grid">
                <div class="status-item">
                    <span class="status-value" id="contractAddress">æœªè¿æ¥</span>
                    <span class="status-label">åˆçº¦åœ°å€</span>
                </div>
                <div class="status-item">
                    <span class="status-value" id="ownerCount">-</span>
                    <span class="status-label">æ‰€æœ‰è€…æ•°é‡</span>
                </div>
                <div class="status-item">
                    <span class="status-value" id="requiredConfirmations">-</span>
                    <span class="status-label">æ‰€éœ€ç¡®è®¤æ•°</span>
                </div>
                <div class="status-item">
                    <span class="status-value" id="contractBalance">-</span>
                    <span class="status-label">åˆçº¦ä½™é¢ (ETH)</span>
                </div>
                <div class="status-item">
                    <span class="status-value" id="transactionCount">-</span>
                    <span class="status-label">äº¤æ˜“æ€»æ•°</span>
                </div>
                <div class="status-item">
                    <span class="status-value" id="networkStatus">ç¦»çº¿</span>
                    <span class="status-label">ç½‘ç»œçŠ¶æ€</span>
                </div>
            </div>
        </div>

        <div class="demo-grid">
            <div class="demo-section">
                <h2>ğŸ”§ åˆçº¦è¿æ¥</h2>
                <div class="form-group">
                    <label for="contractAddressInput">åˆçº¦åœ°å€:</label>
                    <input type="text" id="contractAddressInput" placeholder="0x..." />
                </div>
                <button class="btn" onclick="connectContract()">è¿æ¥åˆçº¦</button>
                <button class="btn btn-secondary" onclick="switchToSepolia()">åˆ‡æ¢åˆ°Sepolia</button>
            </div>

            <div class="demo-section">
                <h2>ğŸ“ æäº¤äº¤æ˜“</h2>
                <div class="form-group">
                    <label for="recipientAddress">æ¥æ”¶åœ°å€:</label>
                    <input type="text" id="recipientAddress" placeholder="0x..." />
                </div>
                <div class="form-group">
                    <label for="ethAmount">ETHæ•°é‡:</label>
                    <input type="number" id="ethAmount" step="0.001" placeholder="0.01" />
                </div>
                <button class="btn" onclick="submitTransaction()">æäº¤äº¤æ˜“</button>
            </div>

            <div class="demo-section">
                <h2>âœ… äº¤æ˜“ç®¡ç†</h2>
                <div class="form-group">
                    <label for="transactionId">äº¤æ˜“ID:</label>
                    <input type="number" id="transactionId" placeholder="0" />
                </div>
                <button class="btn" onclick="confirmTransaction()">ç¡®è®¤äº¤æ˜“</button>
                <button class="btn btn-secondary" onclick="executeTransaction()">æ‰§è¡Œäº¤æ˜“</button>
                <button class="btn btn-danger" onclick="revokeConfirmation()">æ’¤é”€ç¡®è®¤</button>
            </div>

            <div class="demo-section">
                <h2>ğŸ” æŸ¥è¯¢åŠŸèƒ½</h2>
                <button class="btn" onclick="refreshStatus()">åˆ·æ–°çŠ¶æ€</button>
                <button class="btn btn-secondary" onclick="loadTransactions()">åŠ è½½äº¤æ˜“</button>
                <button class="btn btn-secondary" onclick="checkOwnerStatus()">æ£€æŸ¥OwnerçŠ¶æ€</button>
            </div>

            <div class="log-section">
                <h2>ğŸ“‹ æ“ä½œæ—¥å¿—</h2>
                <div id="logContainer">
                    <div class="log-entry info">
                        <strong>[ç³»ç»Ÿ]</strong> æ¬¢è¿ä½¿ç”¨MultiSig Wallet Sepoliaæµ‹è¯•ç½‘äº¤äº’æ¼”ç¤ºï¼
                    </div>
                    <div class="log-entry warning">
                        <strong>[æé†’]</strong> è¯·å…ˆéƒ¨ç½²åˆçº¦å¹¶è¾“å…¥åˆçº¦åœ°å€
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•ç½‘é…ç½®
        const SEPOLIA_CONFIG = {
            chainId: 11155111,
            name: 'Sepolia',
            rpcUrl: 'https://ethereum-sepolia-rpc.publicnode.com',
            blockExplorer: 'https://sepolia.etherscan.io'
        };

        // åˆçº¦ABI
        const MULTISIG_ABI = [
            "function submitTransaction(address _to, uint256 _value, bytes memory _data) public returns (uint256)",
            "function confirmTransaction(uint256 _transactionId) public",
            "function executeTransaction(uint256 _transactionId) public",
            "function revokeConfirmation(uint256 _transactionId) public",
            "function getOwnerCount() public view returns (uint256)",
            "function getTransactionCount() public view returns (uint256)",
            "function getTransaction(uint256 _transactionId) public view returns (address, uint256, bytes memory, bool, uint256)",
            "function isOwner(address _address) public view returns (bool)",
            "function required() public view returns (uint256)",
            "event TransactionSubmitted(uint256 indexed transactionId, address indexed to, uint256 value, bytes data, address indexed submitter)",
            "event TransactionConfirmed(uint256 indexed transactionId, address indexed owner)",
            "event TransactionExecuted(uint256 indexed transactionId)"
        ];

        // å…¨å±€å˜é‡
        let provider;
        let signer;
        let contract;
        let CONTRACT_ADDRESS = "0x5f8708de92E019FB4337083b0991D621505ef334";

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // è¿æ¥åˆçº¦
        async function connectContract() {
            try {
                const addressInput = document.getElementById('contractAddressInput').value;
                
                // ä½¿ç”¨è¾“å…¥çš„åœ°å€æˆ–é»˜è®¤åœ°å€
                if (addressInput) {
                    CONTRACT_ADDRESS = addressInput;
                } else if (!CONTRACT_ADDRESS) {
                    log('âŒ è¯·è¾“å…¥åˆçº¦åœ°å€', 'error');
                    return;
                }

                // ä¼˜å…ˆä½¿ç”¨MetaMaskï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨åªè¯»æ¨¡å¼
                if (typeof window.ethereum !== 'undefined') {
                    try {
                        provider = new ethers.providers.Web3Provider(window.ethereum);
                        await window.ethereum.request({ method: 'eth_requestAccounts' });
                        
                        const network = await provider.getNetwork();
                        if (network.chainId !== SEPOLIA_CONFIG.chainId) {
                            log('âš ï¸ å½“å‰ä¸åœ¨Sepoliaç½‘ç»œï¼Œåˆ‡æ¢åˆ°åªè¯»æ¨¡å¼', 'warning');
                            // åˆ‡æ¢åˆ°åªè¯»æ¨¡å¼
                            provider = new ethers.providers.JsonRpcProvider(SEPOLIA_CONFIG.rpcUrl);
                            contract = new ethers.Contract(CONTRACT_ADDRESS, MULTISIG_ABI, provider);
                        } else {
                            signer = provider.getSigner();
                            contract = new ethers.Contract(CONTRACT_ADDRESS, MULTISIG_ABI, signer);
                        }
                    } catch (walletError) {
                        log('âš ï¸ MetaMaskè¿æ¥å¤±è´¥ï¼Œä½¿ç”¨åªè¯»æ¨¡å¼', 'warning');
                        provider = new ethers.providers.JsonRpcProvider(SEPOLIA_CONFIG.rpcUrl);
                        contract = new ethers.Contract(CONTRACT_ADDRESS, MULTISIG_ABI, provider);
                    }
                } else {
                    log('â„¹ï¸ æœªæ£€æµ‹åˆ°MetaMaskï¼Œä½¿ç”¨åªè¯»æ¨¡å¼', 'info');
                    provider = new ethers.providers.JsonRpcProvider(SEPOLIA_CONFIG.rpcUrl);
                    contract = new ethers.Contract(CONTRACT_ADDRESS, MULTISIG_ABI, provider);
                }

                document.getElementById('contractAddress').textContent = CONTRACT_ADDRESS.substring(0, 10) + '...';
                document.getElementById('networkStatus').textContent = 'å·²è¿æ¥';
                
                await refreshStatus();
                log('âœ… åˆçº¦è¿æ¥æˆåŠŸ', 'success');

            } catch (error) {
                log(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åˆ‡æ¢åˆ°Sepoliaç½‘ç»œ
        async function switchToSepolia() {
            try {
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: `0x${SEPOLIA_CONFIG.chainId.toString(16)}` }],
                });
                log('âœ… å·²åˆ‡æ¢åˆ°Sepoliaç½‘ç»œ', 'success');
            } catch (error) {
                log(`âŒ åˆ‡æ¢ç½‘ç»œå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æäº¤äº¤æ˜“
        async function submitTransaction() {
            try {
                if (!contract) {
                    log('âŒ è¯·å…ˆè¿æ¥åˆçº¦', 'error');
                    return;
                }

                if (!signer) {
                    log('âŒ å½“å‰ä¸ºåªè¯»æ¨¡å¼ï¼Œæ— æ³•æäº¤äº¤æ˜“ã€‚è¯·è¿æ¥MetaMaské’±åŒ…è¿›è¡Œäº¤æ˜“æ“ä½œã€‚', 'error');
                    return;
                }

                const recipient = document.getElementById('recipientAddress').value;
                const amount = document.getElementById('ethAmount').value;

                if (!recipient || !amount) {
                    log('âŒ è¯·å¡«å†™æ¥æ”¶åœ°å€å’Œé‡‘é¢', 'error');
                    return;
                }

                const value = ethers.parseEther(amount);
                const tx = await contract.submitTransaction(recipient, value, "0x");
                
                log(`â³ æäº¤äº¤æ˜“ä¸­... å“ˆå¸Œ: ${tx.hash}`, 'info');
                const receipt = await tx.wait();
                
                log('âœ… äº¤æ˜“æäº¤æˆåŠŸ', 'success');
                await refreshStatus();

            } catch (error) {
                log(`âŒ æäº¤äº¤æ˜“å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // ç¡®è®¤äº¤æ˜“
        async function confirmTransaction() {
            try {
                if (!contract) {
                    log('âŒ è¯·å…ˆè¿æ¥åˆçº¦', 'error');
                    return;
                }

                if (!signer) {
                    log('âŒ å½“å‰ä¸ºåªè¯»æ¨¡å¼ï¼Œæ— æ³•ç¡®è®¤äº¤æ˜“ã€‚è¯·è¿æ¥MetaMaské’±åŒ…è¿›è¡Œäº¤æ˜“æ“ä½œã€‚', 'error');
                    return;
                }

                const txId = document.getElementById('transactionId').value;
                if (!txId) {
                    log('âŒ è¯·è¾“å…¥äº¤æ˜“ID', 'error');
                    return;
                }

                const tx = await contract.confirmTransaction(txId);
                log(`â³ ç¡®è®¤äº¤æ˜“ä¸­... å“ˆå¸Œ: ${tx.hash}`, 'info');
                await tx.wait();
                
                log('âœ… äº¤æ˜“ç¡®è®¤æˆåŠŸ', 'success');
                await refreshStatus();

            } catch (error) {
                log(`âŒ ç¡®è®¤äº¤æ˜“å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ‰§è¡Œäº¤æ˜“
        async function executeTransaction() {
            try {
                if (!contract) {
                    log('âŒ è¯·å…ˆè¿æ¥åˆçº¦', 'error');
                    return;
                }

                if (!signer) {
                    log('âŒ å½“å‰ä¸ºåªè¯»æ¨¡å¼ï¼Œæ— æ³•æ‰§è¡Œäº¤æ˜“ã€‚è¯·è¿æ¥MetaMaské’±åŒ…è¿›è¡Œäº¤æ˜“æ“ä½œã€‚', 'error');
                    return;
                }

                const txId = document.getElementById('transactionId').value;
                if (!txId) {
                    log('âŒ è¯·è¾“å…¥äº¤æ˜“ID', 'error');
                    return;
                }

                const tx = await contract.executeTransaction(txId);
                log(`â³ æ‰§è¡Œäº¤æ˜“ä¸­... å“ˆå¸Œ: ${tx.hash}`, 'info');
                await tx.wait();
                
                log('âœ… äº¤æ˜“æ‰§è¡ŒæˆåŠŸ', 'success');
                await refreshStatus();

            } catch (error) {
                log(`âŒ æ‰§è¡Œäº¤æ˜“å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ’¤é”€ç¡®è®¤
        async function revokeConfirmation() {
            try {
                if (!contract) {
                    log('âŒ è¯·å…ˆè¿æ¥åˆçº¦', 'error');
                    return;
                }

                if (!signer) {
                    log('âŒ å½“å‰ä¸ºåªè¯»æ¨¡å¼ï¼Œæ— æ³•æ’¤é”€ç¡®è®¤ã€‚è¯·è¿æ¥MetaMaské’±åŒ…è¿›è¡Œäº¤æ˜“æ“ä½œã€‚', 'error');
                    return;
                }

                const txId = document.getElementById('transactionId').value;
                if (!txId) {
                    log('âŒ è¯·è¾“å…¥äº¤æ˜“ID', 'error');
                    return;
                }

                const tx = await contract.revokeConfirmation(txId);
                log(`â³ æ’¤é”€ç¡®è®¤ä¸­... å“ˆå¸Œ: ${tx.hash}`, 'info');
                await tx.wait();
                
                log('âœ… æ’¤é”€ç¡®è®¤æˆåŠŸ', 'success');
                await refreshStatus();

            } catch (error) {
                log(`âŒ æ’¤é”€ç¡®è®¤å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åˆ·æ–°çŠ¶æ€
        async function refreshStatus() {
            try {
                if (!contract) return;

                const ownerCount = await contract.getOwnerCount();
                const required = await contract.required();
                const txCount = await contract.getTransactionCount();
                const balance = await provider.getBalance(CONTRACT_ADDRESS);

                document.getElementById('ownerCount').textContent = ownerCount.toString();
                document.getElementById('requiredConfirmations').textContent = required.toString();
                document.getElementById('transactionCount').textContent = txCount.toString();
                document.getElementById('contractBalance').textContent = ethers.utils.formatEther(balance);

                log('âœ… çŠ¶æ€æ›´æ–°å®Œæˆ', 'info');

            } catch (error) {
                log(`âŒ åˆ·æ–°çŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ£€æŸ¥OwnerçŠ¶æ€
        async function checkOwnerStatus() {
            try {
                if (!contract) {
                    log('âŒ è¯·å…ˆè¿æ¥åˆçº¦', 'error');
                    return;
                }

                const address = await signer.getAddress();
                const isOwner = await contract.isOwner(address);
                
                log(`ğŸ‘¤ å½“å‰è´¦æˆ·: ${address}`, 'info');
                log(`ğŸ›ï¸ æ˜¯å¦ä¸ºOwner: ${isOwner ? 'æ˜¯' : 'å¦'}`, isOwner ? 'success' : 'warning');

            } catch (error) {
                log(`âŒ æ£€æŸ¥OwnerçŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åŠ è½½äº¤æ˜“åˆ—è¡¨
        async function loadTransactions() {
            try {
                if (!contract) {
                    log('âŒ è¯·å…ˆè¿æ¥åˆçº¦', 'error');
                    return;
                }

                const txCount = await contract.getTransactionCount();
                log(`ğŸ“‹ æ€»äº¤æ˜“æ•°: ${txCount}`, 'info');

                for (let i = 0; i < Math.min(txCount, 5); i++) {
                    const tx = await contract.getTransaction(i);
                    log(`äº¤æ˜“ ${i}: ç›®æ ‡=${tx[0]}, é‡‘é¢=${ethers.utils.formatEther(tx[1])} ETH, å·²æ‰§è¡Œ=${tx[3]}`, 'info');
                }

            } catch (error) {
                log(`âŒ åŠ è½½äº¤æ˜“å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', function() {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆ', 'info');
            
            // å¦‚æœå·²æœ‰åˆçº¦åœ°å€ï¼Œè‡ªåŠ¨è¿æ¥
            if (CONTRACT_ADDRESS) {
                document.getElementById('contractAddressInput').value = CONTRACT_ADDRESS;
                log('â„¹ï¸ æ£€æµ‹åˆ°é¢„è®¾åˆçº¦åœ°å€ï¼Œè‡ªåŠ¨è¿æ¥ä¸­...', 'info');
                connectContract();
            } else {
                log('â„¹ï¸ è¯·è¾“å…¥åˆçº¦åœ°å€å¹¶ç‚¹å‡»è¿æ¥åˆçº¦', 'info');
            }
        });
    </script>
</body>
</html>
