<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiSig Wallet - å®æ—¶äº¤äº’æ¼”ç¤º</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        // å¤‡ç”¨ethersåº“åŠ è½½
        if (typeof ethers === 'undefined') {
            console.log('ä¸»CDNå¤±è´¥ï¼Œå°è¯•å¤‡ç”¨CDN...');
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js';
            script.onerror = function() {
                console.error('æ‰€æœ‰CDNéƒ½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                alert('æ— æ³•åŠ è½½ethersåº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ä½¿ç”¨æœ¬åœ°ç¯å¢ƒ');
            };
            document.head.appendChild(script);
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 0;
        }

        .header h1 {
            font-size: 3.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .status-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            color: white;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .status-item {
            text-align: center;
        }

        .status-value {
            font-size: 1.8em;
            font-weight: bold;
            display: block;
        }

        .status-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .demo-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .demo-section h2 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .output {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }

        .success {
            color: #28a745;
        }

        .error {
            color: #dc3545;
        }

        .info {
            color: #17a2b8;
        }

        .warning {
            color: #ffc107;
        }

        .transactions-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .transaction-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }

        .transaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .transaction-id {
            font-weight: bold;
            color: #667eea;
        }

        .transaction-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-executed {
            background: #d4edda;
            color: #155724;
        }

        .status-ready {
            background: #cce7ff;
            color: #004085;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .full-width {
            grid-column: 1 / -1;
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="header">
            <h1>ğŸ” MultiSig Wallet</h1>
            <div style="font-size: 1.3em; opacity: 0.9;">å®æ—¶äº¤äº’æ¼”ç¤º</div>
            <div style="font-size: 1.1em; opacity: 0.8; margin-top: 10px;">
                ä¸æœ¬åœ°HardhatèŠ‚ç‚¹å®æ—¶äº¤äº’
            </div>
        </div>

        <!-- è´¦æˆ·é€‰æ‹©å™¨ -->
        <div class="status-bar">
            <div style="margin-bottom: 20px;">
                <h3 style="color: white; margin-bottom: 15px;">ğŸ‘¤ è´¦æˆ·é€‰æ‹© (å¤šç­¾åæ¼”ç¤º)</h3>
                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                    <label style="color: white; font-weight: bold;">å½“å‰è´¦æˆ·:</label>
                    <select id="accountSelector" onchange="switchAccount()" style="padding: 8px 12px; border-radius: 6px; border: none; background: white; min-width: 200px;">
                        <option value="">è¿æ¥ä¸­...</option>
                    </select>
                    <div id="currentAccountInfo" style="color: #ccc; font-size: 0.9em;">
                        ä½™é¢: - ETH | è§’è‰²: -
                    </div>
                </div>
            </div>
        </div>

        <!-- çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="status-grid">
                <div class="status-item">
                    <span class="status-value" id="contractAddress">è¿æ¥ä¸­...</span>
                    <div class="status-label">åˆçº¦åœ°å€</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="ownersCount">-</span>
                    <div class="status-label">æ‰€æœ‰è€…æ•°é‡</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="requiredConfirmations">-</span>
                    <div class="status-label">æ‰€éœ€ç¡®è®¤æ•°</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="transactionCount">-</span>
                    <div class="status-label">äº¤æ˜“æ€»æ•°</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="contractBalance">-</span>
                    <div class="status-label">åˆçº¦ä½™é¢ (ETH)</div>
                </div>
                <div class="status-item">
                    <span class="status-value" id="networkStatus">-</span>
                    <div class="status-label">ç½‘ç»œçŠ¶æ€</div>
                </div>
            </div>
        </div>

        <!-- æ¼”ç¤ºåŒºåŸŸ -->
        <div class="demo-grid">
            <!-- äº¤æ˜“æäº¤ -->
            <div class="demo-section">
                <h2>ğŸ’° æäº¤äº¤æ˜“</h2>
                <div class="form-group">
                    <label>ç›®æ ‡åœ°å€:</label>
                    <input type="text" id="submitTo" placeholder="0x..." value="0x70997970C51812dc3A010C7d01b50e0d17dc79C8">
                </div>
                <div class="form-group">
                    <label>é‡‘é¢ (ETH):</label>
                    <input type="number" id="submitValue" placeholder="0.1" step="0.01" value="0.1">
                </div>
                <div class="form-group">
                    <label>æ•°æ® (å¯é€‰):</label>
                    <input type="text" id="submitData" placeholder="0x" value="0x">
                </div>
                <button class="btn" onclick="submitTransaction()">æäº¤äº¤æ˜“</button>
                <div class="output" id="submitOutput">ç­‰å¾…æ“ä½œ...</div>
            </div>

            <!-- äº¤æ˜“ç¡®è®¤ -->
            <div class="demo-section">
                <h2>âœ… ç¡®è®¤äº¤æ˜“</h2>
                <div class="form-group">
                    <label>äº¤æ˜“ID:</label>
                    <input type="number" id="confirmTxId" placeholder="0" value="0">
                </div>
                <button class="btn" onclick="confirmTransaction()">ç¡®è®¤äº¤æ˜“</button>
                <button class="btn" onclick="executeTransaction()">æ‰§è¡Œäº¤æ˜“</button>
                <button class="btn" onclick="revokeConfirmation()">æ’¤é”€ç¡®è®¤</button>
                <div class="output" id="confirmOutput">ç­‰å¾…æ“ä½œ...</div>
            </div>

            <!-- æ‰¹é‡æ“ä½œ -->
            <div class="demo-section">
                <h2>âš¡ æ‰¹é‡æ“ä½œ</h2>
                <div class="form-group">
                    <label>æ‰¹é‡ç±»å‹:</label>
                    <select id="batchType">
                        <option value="submit">æ‰¹é‡æäº¤</option>
                        <option value="confirm">æ‰¹é‡ç¡®è®¤</option>
                        <option value="revoke">æ‰¹é‡æ’¤é”€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>äº¤æ˜“IDåˆ—è¡¨ (é€—å·åˆ†éš”):</label>
                    <input type="text" id="batchIds" placeholder="0,1,2" value="0,1,2">
                </div>
                <button class="btn" onclick="performBatchOperation()">æ‰§è¡Œæ‰¹é‡æ“ä½œ</button>
                <div class="output" id="batchOutput">ç­‰å¾…æ“ä½œ...</div>
            </div>

            <!-- åˆçº¦çŠ¶æ€ -->
            <div class="demo-section">
                <h2>ğŸ“Š åˆçº¦çŠ¶æ€</h2>
                <button class="btn" onclick="refreshStatus()">åˆ·æ–°çŠ¶æ€</button>
                <button class="btn" onclick="getOwners()">è·å–æ‰€æœ‰è€…</button>
                <button class="btn" onclick="checkAllTransactions()">æ£€æŸ¥æ‰€æœ‰äº¤æ˜“</button>
                <button class="btn" onclick="fundContract()">å‘åˆçº¦è½¬è´¦ 1 ETH</button>
                <button class="btn" onclick="pauseContract()">æš‚åœåˆçº¦</button>
                <div class="output" id="statusOutput">ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹çŠ¶æ€...</div>
            </div>

            <!-- äº¤æ˜“åˆ—è¡¨ -->
            <div class="demo-section full-width">
                <h2>ğŸ“‹ äº¤æ˜“åˆ—è¡¨</h2>
                <button class="btn" onclick="loadTransactions()">åŠ è½½äº¤æ˜“</button>
                <button class="btn" onclick="clearTransactions()">æ¸…ç©ºåˆ—è¡¨</button>
                <div class="transactions-list" id="transactionsList">
                    <div style="text-align: center; color: #666; padding: 20px;">
                        ç‚¹å‡»"åŠ è½½äº¤æ˜“"æŸ¥çœ‹æ‰€æœ‰äº¤æ˜“
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åˆçº¦é…ç½®
        const CONTRACT_ADDRESS = '0xe7f1725E7734CE288F8367e1Bb143E90bb3F0512';
        const RPC_URL = 'http://127.0.0.1:8545';
        
        // åˆçº¦ABI (ç®€åŒ–ç‰ˆ)
        const CONTRACT_ABI = [
            "function submitTransaction(address to, uint256 value, bytes calldata data) external returns (uint256)",
            "function confirmTransaction(uint256 transactionId) external",
            "function executeTransaction(uint256 transactionId) external",
            "function revokeConfirmation(uint256 transactionId) external",
            "function batchSubmit(address[] calldata destinations, uint256[] calldata values, bytes[] calldata dataArray) external",
            "function batchConfirm(uint256[] calldata transactionIds) external",
            "function batchRevoke(uint256[] calldata transactionIds) external",
            "function getOwners() external view returns (address[] memory)",
            "function required() external view returns (uint256)",
            "function getTransactionCount() external view returns (uint256)",
            "function isConfirmed(uint256 transactionId) external view returns (bool)",
            "function getConfirmationCount(uint256 transactionId) external view returns (uint256)",
            "function getTransaction(uint256 transactionId) external view returns (address, uint256, bytes memory, bool)",
            "function paused() external view returns (bool)",
            "function emergencyPause() external",
            "function emergencyUnpause() external",
            "event TransactionSubmitted(uint256 indexed transactionId, address indexed to, uint256 value, bytes data, address indexed submitter)",
            "event TransactionConfirmed(uint256 indexed transactionId, address indexed owner)",
            "event TransactionExecuted(uint256 indexed transactionId)"
        ];

        let provider;
        let signer;
        let contract;
        let accounts = [];
        let contractOwners = [];
        let currentAccountIndex = 0;

        // åˆå§‹åŒ–
        async function init() {
            try {
                log('æ­£åœ¨è¿æ¥åˆ°æœ¬åœ°HardhatèŠ‚ç‚¹...', 'info');
                
                // è¿æ¥åˆ°æœ¬åœ°èŠ‚ç‚¹
                provider = new ethers.providers.JsonRpcProvider(RPC_URL);
                
                // è·å–è´¦æˆ·
                accounts = await provider.listAccounts();
                signer = provider.getSigner(0);
                
                // è¿æ¥åˆçº¦
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                
                // è·å–åˆçº¦æ‰€æœ‰è€…
                contractOwners = await contract.getOwners();
                
                // åˆå§‹åŒ–è´¦æˆ·é€‰æ‹©å™¨
                await initAccountSelector();
                
                // æ›´æ–°çŠ¶æ€
                await refreshStatus();
                
                // è®¾ç½®äº‹ä»¶ç›‘å¬
                setupEventListeners();
                
                log('âœ… æˆåŠŸè¿æ¥åˆ°åˆçº¦ï¼', 'success');
                document.getElementById('networkStatus').textContent = 'å·²è¿æ¥';
                
            } catch (error) {
                log(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('networkStatus').textContent = 'è¿æ¥å¤±è´¥';
            }
        }

        // è®¾ç½®äº‹ä»¶ç›‘å¬
        function setupEventListeners() {
            try {
                // æ¸…ç†æ‰€æœ‰ç°æœ‰ç›‘å¬å™¨
                contract.removeAllListeners();
                
                contract.on("TransactionSubmitted", (transactionId, to, value, data, submitter) => {
                    const currentAccount = accounts[currentAccountIndex];
                    const isCurrentUser = submitter.toLowerCase() === currentAccount.toLowerCase();
                    log(`ğŸ”„ æ–°äº¤æ˜“æäº¤: ID=${transactionId}, To=${to.slice(0, 10)}..., Value=${ethers.utils.formatEther(value)} ETH`, 'info');
                    if (isCurrentUser) {
                        log(`   ğŸ‘¤ ç”±å½“å‰è´¦æˆ·æäº¤`, 'info');
                    }
                    refreshStatus();
                });

                contract.on("TransactionConfirmed", (transactionId, owner) => {
                    const currentAccount = accounts[currentAccountIndex];
                    const isCurrentUser = owner.toLowerCase() === currentAccount.toLowerCase();
                    log(`âœ… äº¤æ˜“ç¡®è®¤: ID=${transactionId}, Owner=${owner.slice(0, 10)}...`, 'success');
                    if (isCurrentUser) {
                        log(`   ğŸ‘¤ ç”±å½“å‰è´¦æˆ·ç¡®è®¤`, 'success');
                    }
                    refreshStatus();
                });

                contract.on("TransactionExecuted", (transactionId) => {
                    log(`ğŸš€ äº¤æ˜“æ‰§è¡Œ: ID=${transactionId}`, 'success');
                    refreshStatus();
                });

                contract.on("ConfirmationRevoked", (transactionId, owner) => {
                    const currentAccount = accounts[currentAccountIndex];
                    const isCurrentUser = owner.toLowerCase() === currentAccount.toLowerCase();
                    log(`ğŸ”„ ç¡®è®¤æ’¤é”€: ID=${transactionId}, Owner=${owner.slice(0, 10)}...`, 'warning');
                    if (isCurrentUser) {
                        log(`   ğŸ‘¤ ç”±å½“å‰è´¦æˆ·æ’¤é”€`, 'warning');
                    }
                    refreshStatus();
                });

                log(`ğŸ“¡ äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½® (è´¦æˆ·: ${accounts[currentAccountIndex].slice(0, 10)}...)`, 'info');
                
            } catch (error) {
                log(`âš ï¸ è®¾ç½®äº‹ä»¶ç›‘å¬å™¨å¤±è´¥: ${error.message}`, 'warning');
            }
        }

        // åˆ·æ–°çŠ¶æ€
        async function refreshStatus() {
            try {
                const owners = await contract.getOwners();
                const required = await contract.required();
                const txCount = await contract.getTransactionCount();
                const balance = await provider.getBalance(CONTRACT_ADDRESS);
                
                document.getElementById('contractAddress').textContent = CONTRACT_ADDRESS.slice(0, 10) + '...';
                document.getElementById('ownersCount').textContent = owners.length;
                document.getElementById('requiredConfirmations').textContent = required.toString();
                document.getElementById('transactionCount').textContent = txCount.toString();
                document.getElementById('contractBalance').textContent = ethers.utils.formatEther(balance);
                
            } catch (error) {
                log(`åˆ·æ–°çŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æäº¤äº¤æ˜“
        async function submitTransaction() {
            const to = document.getElementById('submitTo').value;
            const value = document.getElementById('submitValue').value;
            const data = document.getElementById('submitData').value || '0x';
            
            if (!to || !value) {
                log('è¯·å¡«å†™ç›®æ ‡åœ°å€å’Œé‡‘é¢', 'warning');
                return;
            }

            try {
                // æ£€æŸ¥åˆçº¦ä½™é¢
                const contractBalance = await provider.getBalance(CONTRACT_ADDRESS);
                const valueWei = ethers.utils.parseEther(value);
                
                log(`ğŸ’° åˆçº¦å½“å‰ä½™é¢: ${ethers.utils.formatEther(contractBalance)} ETH`, 'info');
                log(`ğŸ’¸ è®¡åˆ’è½¬è´¦é‡‘é¢: ${value} ETH`, 'info');
                
                if (contractBalance.lt(valueWei)) {
                    log(`âš ï¸ è­¦å‘Š: åˆçº¦ä½™é¢ä¸è¶³ï¼`, 'warning');
                    log(`   å½“å‰ä½™é¢: ${ethers.utils.formatEther(contractBalance)} ETH`, 'warning');
                    log(`   éœ€è¦é‡‘é¢: ${value} ETH`, 'warning');
                    log(`   ç¼ºå°‘é‡‘é¢: ${ethers.utils.formatEther(valueWei.sub(contractBalance))} ETH`, 'warning');
                    log(`ğŸ’¡ å»ºè®®: å…ˆç‚¹å‡»"å‘åˆçº¦è½¬è´¦"å¢åŠ ä½™é¢`, 'info');
                }
                
                log('æ­£åœ¨æäº¤äº¤æ˜“...', 'info');
                const tx = await contract.submitTransaction(
                    to,
                    ethers.utils.parseEther(value),
                    data
                );
                
                log(`äº¤æ˜“å·²æäº¤ï¼Œç­‰å¾…ç¡®è®¤... Hash: ${tx.hash}`, 'info');
                const receipt = await tx.wait();
                
                // è§£æäº‹ä»¶è·å–äº¤æ˜“ID
                const event = receipt.events?.find(e => e.event === 'TransactionSubmitted');
                if (event && event.args) {
                    const transactionId = event.args.transactionId.toString();
                    log(`âœ… äº¤æ˜“æäº¤æˆåŠŸï¼äº¤æ˜“ID: ${transactionId}`, 'success');
                    document.getElementById('confirmTxId').value = transactionId;
                } else {
                    // å¦‚æœäº‹ä»¶è§£æå¤±è´¥ï¼Œå°è¯•ä»äº¤æ˜“è®¡æ•°æ¨æ–­ID
                    const txCount = await contract.getTransactionCount();
                    const transactionId = (txCount - 1).toString();
                    log(`âœ… äº¤æ˜“æäº¤æˆåŠŸï¼æ¨æ–­äº¤æ˜“ID: ${transactionId}`, 'success');
                    document.getElementById('confirmTxId').value = transactionId;
                }
                
            } catch (error) {
                log(`âŒ æäº¤å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // ç¡®è®¤äº¤æ˜“
        async function confirmTransaction() {
            const txId = document.getElementById('confirmTxId').value;
            
            if (!txId) {
                log('è¯·è¾“å…¥äº¤æ˜“ID', 'warning');
                return;
            }

            try {
                // é¦–å…ˆæ£€æŸ¥äº¤æ˜“çŠ¶æ€
                log(`æ­£åœ¨æ£€æŸ¥äº¤æ˜“ ${txId} çŠ¶æ€...`, 'info');
                const txCount = await contract.getTransactionCount();
                
                if (txId >= txCount) {
                    log(`âŒ äº¤æ˜“ID ${txId} ä¸å­˜åœ¨ (æ€»äº¤æ˜“æ•°: ${txCount})`, 'error');
                    return;
                }

                const [to, value, data, executed] = await contract.getTransaction(txId);
                const confirmations = await contract.getConfirmationCount(txId);
                const required = await contract.required();
                
                if (executed) {
                    log(`âš ï¸ äº¤æ˜“ ${txId} å·²ç»æ‰§è¡Œï¼Œæ— éœ€å†ç¡®è®¤`, 'warning');
                    return;
                }

                log(`äº¤æ˜“ ${txId} å½“å‰ç¡®è®¤æ•°: ${confirmations}/${required}`, 'info');
                
                // æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»ç¡®è®¤è¿‡
                const currentAccount = await signer.getAddress();
                
                // é‡è¦ï¼šæ£€æŸ¥ç¡®è®¤åæ˜¯å¦ä¼šè§¦å‘è‡ªåŠ¨æ‰§è¡Œ
                if (confirmations + 1 >= required) {
                    log(`âš ï¸ è­¦å‘Š: æ­¤æ¬¡ç¡®è®¤å°†è¾¾åˆ°æ‰§è¡Œé˜ˆå€¼ (${confirmations + 1}/${required})`, 'warning');
                    log(`ğŸ” æ£€æŸ¥äº¤æ˜“æ˜¯å¦å¯ä»¥æˆåŠŸæ‰§è¡Œ...`, 'info');
                    
                    // æ£€æŸ¥åˆçº¦ä½™é¢æ˜¯å¦è¶³å¤Ÿ
                    const contractBalance = await provider.getBalance(CONTRACT_ADDRESS);
                    log(`ğŸ’° åˆçº¦ä½™é¢: ${ethers.utils.formatEther(contractBalance)} ETH`, 'info');
                    log(`ğŸ’¸ äº¤æ˜“é‡‘é¢: ${ethers.utils.formatEther(value)} ETH`, 'info');
                    log(`ğŸ“ ç›®æ ‡åœ°å€: ${to}`, 'info');
                    
                    if (contractBalance.lt(value)) {
                        log(`âŒ åˆçº¦ä½™é¢ä¸è¶³ï¼æ— æ³•æ‰§è¡Œäº¤æ˜“`, 'error');
                        log(`   ç¼ºå°‘: ${ethers.utils.formatEther(value.sub(contractBalance))} ETH`, 'error');
                        log(`ğŸ’¡ å»ºè®®: å…ˆå‘åˆçº¦è½¬è´¦ï¼Œæˆ–æäº¤è¾ƒå°é‡‘é¢çš„äº¤æ˜“`, 'info');
                        return;
                    }
                    
                    log(`âœ… ä½™é¢æ£€æŸ¥é€šè¿‡ï¼Œäº¤æ˜“å°†åœ¨ç¡®è®¤åè‡ªåŠ¨æ‰§è¡Œ`, 'success');
                }
                
                // å°è¯•ç¡®è®¤äº¤æ˜“
                log(`æ­£åœ¨ç¡®è®¤äº¤æ˜“ ${txId}...`, 'info');
                const tx = await contract.confirmTransaction(txId);
                
                log(`ç¡®è®¤äº¤æ˜“å·²æäº¤... Hash: ${tx.hash}`, 'info');
                await tx.wait();
                
                log(`âœ… äº¤æ˜“ ${txId} ç¡®è®¤æˆåŠŸï¼`, 'success');
                
                // åˆ·æ–°çŠ¶æ€
                await refreshStatus();
                
            } catch (error) {
                if (error.message.includes('transaction already confirmed')) {
                    const currentAccount = await signer.getAddress();
                    log(`âš ï¸ è´¦æˆ· ${currentAccount.slice(0, 10)}... å·²ç»ç¡®è®¤è¿‡äº¤æ˜“ ${txId}`, 'warning');
                    log(`ğŸ’¡ è¿™æ˜¯æ­£å¸¸çš„å®‰å…¨æœºåˆ¶ï¼Œé˜²æ­¢é‡å¤ç¡®è®¤`, 'info');
                    log(`ğŸ”„ æ‚¨å¯ä»¥åˆ‡æ¢åˆ°å…¶ä»–æ‰€æœ‰è€…è´¦æˆ·è¿›è¡Œç¡®è®¤`, 'info');
                } else if (error.message.includes('not an owner')) {
                    log(`âŒ åªæœ‰åˆçº¦æ‰€æœ‰è€…æ‰èƒ½ç¡®è®¤äº¤æ˜“`, 'error');
                    log(`ğŸ‘‘ è¯·åˆ‡æ¢åˆ°æ‰€æœ‰è€…è´¦æˆ· (å¸¦æœ‰ğŸ‘‘æ ‡è¯†)`, 'info');
                } else {
                    log(`âŒ ç¡®è®¤å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        // æ‰§è¡Œäº¤æ˜“
        async function executeTransaction() {
            const txId = document.getElementById('confirmTxId').value;
            
            if (!txId) {
                log('è¯·è¾“å…¥äº¤æ˜“ID', 'warning');
                return;
            }

            try {
                // æ£€æŸ¥äº¤æ˜“çŠ¶æ€
                log(`æ­£åœ¨æ£€æŸ¥äº¤æ˜“ ${txId} æ‰§è¡Œæ¡ä»¶...`, 'info');
                const txCount = await contract.getTransactionCount();
                
                if (txId >= txCount) {
                    log(`âŒ äº¤æ˜“ID ${txId} ä¸å­˜åœ¨ (æ€»äº¤æ˜“æ•°: ${txCount})`, 'error');
                    return;
                }

                const [to, value, data, executed] = await contract.getTransaction(txId);
                const confirmations = await contract.getConfirmationCount(txId);
                const required = await contract.required();
                
                if (executed) {
                    log(`âš ï¸ äº¤æ˜“ ${txId} å·²ç»æ‰§è¡Œè¿‡äº†`, 'warning');
                    return;
                }

                if (confirmations < required) {
                    log(`âŒ äº¤æ˜“ ${txId} ç¡®è®¤æ•°ä¸è¶³: ${confirmations}/${required}`, 'error');
                    log(`ğŸ’¡ éœ€è¦è‡³å°‘ ${required} ä¸ªç¡®è®¤æ‰èƒ½æ‰§è¡Œ`, 'info');
                    return;
                }

                log(`âœ… äº¤æ˜“ ${txId} æ»¡è¶³æ‰§è¡Œæ¡ä»¶ (${confirmations}/${required})`, 'success');
                log(`æ­£åœ¨æ‰§è¡Œäº¤æ˜“ ${txId}...`, 'info');
                
                const tx = await contract.executeTransaction(txId);
                
                log(`æ‰§è¡Œäº¤æ˜“å·²æäº¤... Hash: ${tx.hash}`, 'info');
                await tx.wait();
                
                log(`âœ… äº¤æ˜“ ${txId} æ‰§è¡ŒæˆåŠŸï¼`, 'success');
                log(`ğŸ’° å·²è½¬è´¦ ${ethers.utils.formatEther(value)} ETH åˆ° ${to}`, 'info');
                
                // åˆ·æ–°çŠ¶æ€
                await refreshStatus();
                
            } catch (error) {
                if (error.message.includes('transaction already executed')) {
                    log(`âš ï¸ äº¤æ˜“ ${txId} å·²ç»æ‰§è¡Œè¿‡äº†`, 'warning');
                } else if (error.message.includes('not enough confirmations')) {
                    log(`âŒ äº¤æ˜“ ${txId} ç¡®è®¤æ•°ä¸è¶³ï¼Œæ— æ³•æ‰§è¡Œ`, 'error');
                } else if (error.message.includes('transaction execution failed')) {
                    log(`âŒ äº¤æ˜“æ‰§è¡Œå¤±è´¥ - å¯èƒ½åŸå› :`, 'error');
                    log(`   â€¢ åˆçº¦ä½™é¢ä¸è¶³`, 'warning');
                    log(`   â€¢ ç›®æ ‡åœ°å€æ— æ•ˆ`, 'warning');
                    log(`   â€¢ Gasé™åˆ¶ä¸è¶³`, 'warning');
                    
                    // æ£€æŸ¥åˆçº¦ä½™é¢
                    try {
                        const contractBalance = await provider.getBalance(CONTRACT_ADDRESS);
                        const [to, value] = await contract.getTransaction(txId);
                        log(`   åˆçº¦ä½™é¢: ${ethers.utils.formatEther(contractBalance)} ETH`, 'info');
                        log(`   éœ€è¦è½¬è´¦: ${ethers.utils.formatEther(value)} ETH`, 'info');
                        
                        if (contractBalance.lt(value)) {
                            log(`ğŸ’¡ å»ºè®®: å…ˆå‘åˆçº¦è½¬è´¦å¢åŠ ä½™é¢`, 'info');
                        }
                    } catch (e) {
                        log(`   æ— æ³•æ£€æŸ¥ä½™é¢è¯¦æƒ…`, 'warning');
                    }
                } else {
                    log(`âŒ æ‰§è¡Œå¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        // æ’¤é”€ç¡®è®¤
        async function revokeConfirmation() {
            const txId = document.getElementById('confirmTxId').value;
            
            if (!txId) {
                log('è¯·è¾“å…¥äº¤æ˜“ID', 'warning');
                return;
            }

            try {
                // æ£€æŸ¥äº¤æ˜“çŠ¶æ€å’Œå½“å‰ç”¨æˆ·ç¡®è®¤çŠ¶æ€
                log(`æ­£åœ¨æ£€æŸ¥äº¤æ˜“ ${txId} ç¡®è®¤çŠ¶æ€...`, 'info');
                const txCount = await contract.getTransactionCount();
                
                if (txId >= txCount) {
                    log(`âŒ äº¤æ˜“ID ${txId} ä¸å­˜åœ¨ (æ€»äº¤æ˜“æ•°: ${txCount})`, 'error');
                    return;
                }

                const [to, value, data, executed] = await contract.getTransaction(txId);
                const confirmations = await contract.getConfirmationCount(txId);
                const currentAccount = await signer.getAddress();
                
                if (executed) {
                    log(`âš ï¸ äº¤æ˜“ ${txId} å·²ç»æ‰§è¡Œï¼Œæ— æ³•æ’¤é”€ç¡®è®¤`, 'warning');
                    return;
                }

                // æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç¡®è®¤æ­¤äº¤æ˜“
                let hasConfirmed = false;
                try {
                    // è¿™é‡Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ç¡®è®¤äº†è¿™ä¸ªäº¤æ˜“
                    // ç”±äºåˆçº¦å¯èƒ½æ²¡æœ‰ç›´æ¥çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆå°è¯•è°ƒç”¨æ’¤é”€
                    log(`å½“å‰è´¦æˆ·: ${currentAccount.slice(0, 10)}...`, 'info');
                    log(`äº¤æ˜“ ${txId} å½“å‰ç¡®è®¤æ•°: ${confirmations}`, 'info');
                    
                    log(`æ­£åœ¨æ’¤é”€äº¤æ˜“ ${txId} çš„ç¡®è®¤...`, 'info');
                    const tx = await contract.revokeConfirmation(txId);
                    
                    log(`æ’¤é”€ç¡®è®¤å·²æäº¤... Hash: ${tx.hash}`, 'info');
                    await tx.wait();
                    
                    log(`âœ… äº¤æ˜“ ${txId} ç¡®è®¤æ’¤é”€æˆåŠŸï¼`, 'success');
                    
                    // åˆ·æ–°çŠ¶æ€
                    await refreshStatus();
                    
                } catch (innerError) {
                    if (innerError.message.includes('transaction not confirmed')) {
                        log(`âš ï¸ å½“å‰è´¦æˆ· ${currentAccount.slice(0, 10)}... å°šæœªç¡®è®¤äº¤æ˜“ ${txId}`, 'warning');
                        log(`ğŸ’¡ åªèƒ½æ’¤é”€æ‚¨å·²ç»ç¡®è®¤è¿‡çš„äº¤æ˜“`, 'info');
                        log(`ğŸ“‹ å»ºè®®: å…ˆç¡®è®¤äº¤æ˜“ï¼Œç„¶åå†å°è¯•æ’¤é”€`, 'info');
                    } else {
                        throw innerError; // é‡æ–°æŠ›å‡ºå…¶ä»–é”™è¯¯
                    }
                }
                
            } catch (error) {
                if (error.message.includes('transaction not confirmed')) {
                    // è¿™ä¸ªé”™è¯¯å·²ç»åœ¨å†…éƒ¨å¤„ç†äº†
                    return;
                } else if (error.message.includes('not an owner')) {
                    log(`âŒ åªæœ‰åˆçº¦æ‰€æœ‰è€…æ‰èƒ½æ’¤é”€ç¡®è®¤`, 'error');
                } else {
                    log(`âŒ æ’¤é”€å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        // æ‰¹é‡æ“ä½œ
        async function performBatchOperation() {
            const batchType = document.getElementById('batchType').value;
            const idsStr = document.getElementById('batchIds').value;
            
            if (!idsStr) {
                log('è¯·è¾“å…¥äº¤æ˜“IDåˆ—è¡¨', 'warning');
                return;
            }

            const ids = idsStr.split(',').map(id => parseInt(id.trim()));

            try {
                log(`æ­£åœ¨æ‰§è¡Œæ‰¹é‡${batchType}æ“ä½œ...`, 'info');
                let tx;
                
                if (batchType === 'submit') {
                    // æ‰¹é‡æäº¤ç¤ºä¾‹
                    const destinations = ids.map(() => '0x70997970C51812dc3A010C7d01b50e0d17dc79C8');
                    const values = ids.map(() => ethers.utils.parseEther('0.01'));
                    const dataArray = ids.map(() => '0x');
                    
                    tx = await contract.batchSubmit(destinations, values, dataArray);
                } else if (batchType === 'confirm') {
                    tx = await contract.batchConfirm(ids);
                } else if (batchType === 'revoke') {
                    tx = await contract.batchRevoke(ids);
                }
                
                log(`æ‰¹é‡æ“ä½œå·²æäº¤... Hash: ${tx.hash}`, 'info');
                await tx.wait();
                
                log(`âœ… æ‰¹é‡${batchType}æ“ä½œæˆåŠŸï¼`, 'success');
                
            } catch (error) {
                log(`âŒ æ‰¹é‡æ“ä½œå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // è·å–æ‰€æœ‰è€…
        async function getOwners() {
            try {
                const owners = await contract.getOwners();
                log('ğŸ“‹ æ‰€æœ‰è€…åˆ—è¡¨:', 'info');
                owners.forEach((owner, index) => {
                    const isCurrentUser = owner.toLowerCase() === accounts[currentAccountIndex].toLowerCase();
                    log(`  ${index + 1}. ${owner} ${isCurrentUser ? 'ğŸ‘¤ (å½“å‰è´¦æˆ·)' : ''}`, 'info');
                });
                
            } catch (error) {
                log(`âŒ è·å–æ‰€æœ‰è€…å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ£€æŸ¥æ‰€æœ‰äº¤æ˜“çŠ¶æ€
        async function checkAllTransactions() {
            try {
                log('ğŸ” æ£€æŸ¥æ‰€æœ‰äº¤æ˜“çŠ¶æ€...', 'info');
                const txCount = await contract.getTransactionCount();
                const required = await contract.required();
                const contractBalance = await provider.getBalance(CONTRACT_ADDRESS);
                
                log(`ğŸ“Š äº¤æ˜“æ€»æ•°: ${txCount}`, 'info');
                log(`ğŸ’° åˆçº¦ä½™é¢: ${ethers.utils.formatEther(contractBalance)} ETH`, 'info');
                log(`ğŸ¯ æ‰€éœ€ç¡®è®¤æ•°: ${required}`, 'info');
                log('â”€'.repeat(50), 'info');
                
                if (txCount == 0) {
                    log('ğŸ“ æš‚æ— äº¤æ˜“', 'info');
                    return;
                }
                
                for (let i = 0; i < txCount; i++) {
                    const [to, value, data, executed] = await contract.getTransaction(i);
                    const confirmations = await contract.getConfirmationCount(i);
                    const valueEth = ethers.utils.formatEther(value);
                    
                    log(`ğŸ“‹ äº¤æ˜“ #${i}:`, 'info');
                    log(`   ç›®æ ‡: ${to.slice(0, 10)}...`, 'info');
                    log(`   é‡‘é¢: ${valueEth} ETH`, 'info');
                    log(`   ç¡®è®¤: ${confirmations}/${required}`, 'info');
                    log(`   çŠ¶æ€: ${executed ? 'âœ… å·²æ‰§è¡Œ' : confirmations >= required ? 'ğŸŸ¡ å¾…æ‰§è¡Œ' : 'ğŸ”„ å¾…ç¡®è®¤'}`, 'info');
                    
                    // æ£€æŸ¥ä½™é¢æ˜¯å¦è¶³å¤Ÿæ‰§è¡Œ
                    if (!executed && confirmations >= required) {
                        if (contractBalance.lt(value)) {
                            log(`   âš ï¸ ä½™é¢ä¸è¶³ï¼Œæ— æ³•æ‰§è¡Œ (ç¼ºå°‘ ${ethers.utils.formatEther(value.sub(contractBalance))} ETH)`, 'warning');
                        } else {
                            log(`   âœ… å¯ä»¥æ‰§è¡Œ`, 'success');
                        }
                    }
                    
                    log('', 'info'); // ç©ºè¡Œåˆ†éš”
                }
                
            } catch (error) {
                log(`âŒ æ£€æŸ¥äº¤æ˜“å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å‘åˆçº¦è½¬è´¦
        async function fundContract() {
            try {
                log('æ­£åœ¨å‘åˆçº¦è½¬è´¦ 1 ETH...', 'info');
                const tx = await signer.sendTransaction({
                    to: CONTRACT_ADDRESS,
                    value: ethers.utils.parseEther('1.0')
                });
                
                log(`è½¬è´¦å·²æäº¤... Hash: ${tx.hash}`, 'info');
                await tx.wait();
                
                log('âœ… è½¬è´¦æˆåŠŸï¼', 'success');
                await refreshStatus();
                
            } catch (error) {
                log(`âŒ è½¬è´¦å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æš‚åœåˆçº¦
        async function pauseContract() {
            try {
                const paused = await contract.paused();
                
                if (paused) {
                    log('æ­£åœ¨æ¢å¤åˆçº¦...', 'info');
                    const tx = await contract.emergencyUnpause();
                    await tx.wait();
                    log('âœ… åˆçº¦å·²æ¢å¤ï¼', 'success');
                } else {
                    log('æ­£åœ¨æš‚åœåˆçº¦...', 'info');
                    const tx = await contract.emergencyPause();
                    await tx.wait();
                    log('âœ… åˆçº¦å·²æš‚åœï¼', 'success');
                }
                
                await refreshStatus();
                
            } catch (error) {
                log(`âŒ æš‚åœ/æ¢å¤å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åŠ è½½äº¤æ˜“åˆ—è¡¨
        async function loadTransactions() {
            try {
                log('æ­£åœ¨åŠ è½½äº¤æ˜“åˆ—è¡¨...', 'info');
                const txCount = await contract.getTransactionCount();
                const transactionsList = document.getElementById('transactionsList');
                
                transactionsList.innerHTML = '';
                
                for (let i = 0; i < txCount; i++) {
                    const [to, value, data, executed] = await contract.getTransaction(i);
                    const confirmations = await contract.getConfirmationCount(i);
                    const required = await contract.required();
                    
                    const txItem = document.createElement('div');
                    txItem.className = 'transaction-item';
                    
                    let status = 'pending';
                    let statusText = 'ç­‰å¾…ç¡®è®¤';
                    
                    if (executed) {
                        status = 'executed';
                        statusText = 'å·²æ‰§è¡Œ';
                    } else if (confirmations >= required) {
                        status = 'ready';
                        statusText = 'å¯æ‰§è¡Œ';
                    }
                    
                    txItem.innerHTML = `
                        <div class="transaction-header">
                            <span class="transaction-id">äº¤æ˜“ #${i}</span>
                            <span class="transaction-status status-${status}">${statusText}</span>
                        </div>
                        <div><strong>ç›®æ ‡:</strong> ${to}</div>
                        <div><strong>é‡‘é¢:</strong> ${ethers.utils.formatEther(value)} ETH</div>
                        <div><strong>ç¡®è®¤æ•°:</strong> ${confirmations}/${required}</div>
                        <div><strong>æ•°æ®:</strong> ${data.length > 10 ? data.slice(0, 10) + '...' : data}</div>
                    `;
                    
                    transactionsList.appendChild(txItem);
                }
                
                log(`âœ… åŠ è½½äº† ${txCount} ä¸ªäº¤æ˜“`, 'success');
                
            } catch (error) {
                log(`âŒ åŠ è½½äº¤æ˜“å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ¸…ç©ºäº¤æ˜“åˆ—è¡¨
        function clearTransactions() {
            document.getElementById('transactionsList').innerHTML = `
                <div style="text-align: center; color: #666; padding: 20px;">
                    ç‚¹å‡»"åŠ è½½äº¤æ˜“"æŸ¥çœ‹æ‰€æœ‰äº¤æ˜“
                </div>
            `;
        }

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const outputs = ['submitOutput', 'confirmOutput', 'batchOutput', 'statusOutput'];
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            
            // æ›´æ–°æ‰€æœ‰è¾“å‡ºåŒºåŸŸçš„æœ€åä¸€ä¸ª
            outputs.forEach(outputId => {
                const output = document.getElementById(outputId);
                if (output && output.textContent !== 'ç­‰å¾…æ“ä½œ...' && output.textContent !== 'ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹çŠ¶æ€...') {
                    const lines = output.innerHTML.split('<br>');
                    if (lines.length > 10) {
                        lines.shift(); // ç§»é™¤æœ€æ—§çš„æ—¥å¿—
                    }
                    lines.push(`<span class="${type}">${logMessage}</span>`);
                    output.innerHTML = lines.join('<br>');
                    output.scrollTop = output.scrollHeight;
                }
            });
            
            // æ›´æ–°å½“å‰æ´»åŠ¨çš„è¾“å‡ºåŒºåŸŸ
            const activeOutput = document.querySelector('.output:hover') || document.getElementById('statusOutput');
            if (activeOutput) {
                const lines = activeOutput.innerHTML.split('<br>');
                if (lines.length > 10) {
                    lines.shift();
                }
                lines.push(`<span class="${type}">${logMessage}</span>`);
                activeOutput.innerHTML = lines.join('<br>');
                activeOutput.scrollTop = activeOutput.scrollHeight;
            }
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // åˆå§‹åŒ–è´¦æˆ·é€‰æ‹©å™¨
        async function initAccountSelector() {
            const selector = document.getElementById('accountSelector');
            selector.innerHTML = '';
            
            for (let i = 0; i < accounts.length; i++) {
                const account = accounts[i];
                const isOwner = contractOwners.includes(account);
                const balance = await provider.getBalance(account);
                const balanceEth = ethers.utils.formatEther(balance);
                
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${account.slice(0, 6)}...${account.slice(-4)} (${balanceEth.slice(0, 6)} ETH) ${isOwner ? 'ğŸ‘‘ æ‰€æœ‰è€…' : 'ğŸ‘¤ æ™®é€šè´¦æˆ·'}`;
                
                if (i === currentAccountIndex) {
                    option.selected = true;
                }
                
                selector.appendChild(option);
            }
            
            await updateCurrentAccountInfo();
        }

        // åˆ‡æ¢è´¦æˆ·
        async function switchAccount() {
            const selector = document.getElementById('accountSelector');
            const newIndex = parseInt(selector.value);
            
            if (newIndex !== currentAccountIndex) {
                log(`ğŸ”„ æ­£åœ¨åˆ‡æ¢è´¦æˆ·...`, 'info');
                
                // æ¸…ç†æ—§çš„äº‹ä»¶ç›‘å¬å™¨
                if (contract) {
                    contract.removeAllListeners();
                }
                
                currentAccountIndex = newIndex;
                signer = provider.getSigner(currentAccountIndex);
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                
                // æ›´æ–°è´¦æˆ·ä¿¡æ¯
                await updateCurrentAccountInfo();
                
                // åˆ·æ–°åˆçº¦çŠ¶æ€
                await refreshStatus();
                
                // é‡æ–°è®¾ç½®äº‹ä»¶ç›‘å¬
                setupEventListeners();
                
                const currentAccount = accounts[currentAccountIndex];
                const isOwner = contractOwners.includes(currentAccount);
                log(`âœ… å·²åˆ‡æ¢åˆ°è´¦æˆ· ${currentAccount.slice(0, 10)}... ${isOwner ? '(ğŸ‘‘ æ‰€æœ‰è€…)' : '(ğŸ‘¤ æ™®é€šè´¦æˆ·)'}`, 'success');
            }
        }

        // æ›´æ–°å½“å‰è´¦æˆ·ä¿¡æ¯
        async function updateCurrentAccountInfo() {
            try {
                const currentAccount = accounts[currentAccountIndex];
                const balance = await provider.getBalance(currentAccount);
                const balanceEth = ethers.utils.formatEther(balance);
                const isOwner = contractOwners.includes(currentAccount);
                
                const info = document.getElementById('currentAccountInfo');
                info.innerHTML = `
                    ä½™é¢: ${balanceEth.slice(0, 8)} ETH | 
                    è§’è‰²: ${isOwner ? '<span style="color: #ffd700;">ğŸ‘‘ åˆçº¦æ‰€æœ‰è€…</span>' : '<span style="color: #ccc;">ğŸ‘¤ æ™®é€šè´¦æˆ·</span>'}
                `;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                const buttons = document.querySelectorAll('.btn');
                buttons.forEach(btn => {
                    if (!isOwner && (btn.textContent.includes('ç¡®è®¤') || btn.textContent.includes('æ‰§è¡Œ') || btn.textContent.includes('æ’¤é”€') || btn.textContent.includes('æš‚åœ'))) {
                        btn.style.opacity = '0.5';
                        btn.title = 'åªæœ‰åˆçº¦æ‰€æœ‰è€…æ‰èƒ½æ‰§è¡Œæ­¤æ“ä½œ';
                    } else {
                        btn.style.opacity = '1';
                        btn.title = '';
                    }
                });
                
            } catch (error) {
                console.error('æ›´æ–°è´¦æˆ·ä¿¡æ¯å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', init);
    </script>
</body>
</html>
